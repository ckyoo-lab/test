<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì í˜ì´ì§€</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: #f5f7fa; 
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        
        /* ë¡œê·¸ì¸ í™”ë©´ */
        #loginScreen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 80vh;
        }
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
        }
        .login-box h1 {
            color: #1e3c72;
            margin-bottom: 30px;
            text-align: center;
        }
        
        /* ê´€ë¦¬ì í™”ë©´ */
        #adminScreen { display: none; }
        
        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: bold;
        }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
        }
        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
        }
        .btn-primary:hover { opacity: 0.9; }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .btn-logout {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 8px 16px;
        }
        .btn-logout:hover { background: rgba(255,255,255,0.3); }
        
        .btn-sm { padding: 5px 10px; font-size: 12px; margin-right: 5px; }
        .btn-success { background: #4caf50; color: white; }
        .btn-warning { background: #ff9800; color: white; }
        .btn-danger { background: #f44336; color: white; }
        
        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        .card h2 {
            color: #1e3c72;
            margin-bottom: 20px;
        }
        
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e0e0e0; }
        th { background: #e3f2fd; color: #1976d2; font-weight: bold; }
        tr:hover { background: #f5f5f5; }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: white;
            padding: 10px;
            border-radius: 10px;
        }
        .tab {
            padding: 10px 20px;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: bold;
            color: #666;
            border-bottom: 3px solid transparent;
        }
        .tab.active { color: #667eea; border-bottom-color: #667eea; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-completed { background: #d4edda; color: #155724; }
        
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .alert-error { background: #f8d7da; color: #721c24; }
        .alert-success { background: #d4edda; color: #155724; }
        .alert-info { background: #d1ecf1; color: #0c5460; }
        
        .loading { text-align: center; padding: 40px; color: #667eea; }
        .empty { text-align: center; padding: 40px; color: #999; }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-card h3 { font-size: 2rem; margin-bottom: 5px; }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
    </style>
</head>
<body>
    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="loginScreen">
        <div class="login-box">
            <h1>ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</h1>
            <div id="loginError"></div>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>ì´ë©”ì¼</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label>ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary" id="loginBtn">ë¡œê·¸ì¸</button>
            </form>
            <div style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 5px; font-size: 12px;">
                <strong>í…ŒìŠ¤íŠ¸ ê³„ì •:</strong><br>
                Email: ckyoo@web2002.co.kr<br>
                Password: Admin2024!
            </div>
        </div>
    </div>

    <!-- ê´€ë¦¬ì í™”ë©´ -->
    <div id="adminScreen" class="container">
        <header>
            <div>
                <h1>ê´€ë¦¬ì í˜ì´ì§€</h1>
                <p>ìˆ˜ì¶œë°”ìš°ì²˜ ì»¨ì„¤íŒ… ê´€ë¦¬</p>
            </div>
            <button class="btn btn-logout" onclick="handleLogout()">ë¡œê·¸ì•„ì›ƒ</button>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('dashboard')">ğŸ“Š ëŒ€ì‹œë³´ë“œ</button>
            <button class="tab" onclick="switchTab('contacts')">ğŸ“§ ë¬¸ì˜ ê´€ë¦¬</button>
            <button class="tab" onclick="switchTab('faqs')">â“ FAQ ê´€ë¦¬</button>
        </div>

        <!-- ëŒ€ì‹œë³´ë“œ -->
        <div id="dashboard" class="tab-content active">
            <div class="stats">
                <div class="stat-card">
                    <h3 id="totalContacts">0</h3>
                    <p>ì´ ë¬¸ì˜</p>
                </div>
                <div class="stat-card">
                    <h3 id="pendingContacts">0</h3>
                    <p>ë¯¸ë‹µë³€</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalFAQs">0</h3>
                    <p>FAQ</p>
                </div>
            </div>
            <div class="card">
                <h2>ìµœê·¼ ë¬¸ì˜</h2>
                <div id="recentContacts" class="loading">ë¡œë”© ì¤‘...</div>
            </div>
        </div>

        <!-- ë¬¸ì˜ ê´€ë¦¬ -->
        <div id="contacts" class="tab-content">
            <div class="card">
                <h2>ë¬¸ì˜ ëª©ë¡</h2>
                <div id="contactsList" class="loading">ë¡œë”© ì¤‘...</div>
            </div>
        </div>

        <!-- FAQ ê´€ë¦¬ -->
        <div id="faqs" class="tab-content">
            <div class="card">
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                    <h2>FAQ ê´€ë¦¬</h2>
                    <button class="btn btn-primary" style="width: auto;" onclick="openFAQModal()">+ ì¶”ê°€</button>
                </div>
                <div id="faqsList" class="loading">ë¡œë”© ì¤‘...</div>
            </div>
        </div>
    </div>

    <!-- FAQ ëª¨ë‹¬ -->
    <div id="faqModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="faqModalTitle">FAQ ì¶”ê°€</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form onsubmit="saveFAQ(event)">
                <input type="hidden" id="faqId">
                <div class="form-group">
                    <label>ì§ˆë¬¸</label>
                    <input type="text" id="faqQuestion" required>
                </div>
                <div class="form-group">
                    <label>ë‹µë³€</label>
                    <textarea id="faqAnswer" rows="5" required></textarea>
                </div>
                <div class="form-group">
                    <label>ìˆœì„œ</label>
                    <input type="number" id="faqOrder" value="1" min="1">
                </div>
                <button type="submit" class="btn btn-primary">ì €ì¥</button>
            </form>
        </div>
    </div>

    <script>
        // âš ï¸ ì—¬ê¸°ì— ë³¸ì¸ì˜ Supabase ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”!
        const SUPABASE_URL = 'https://qcofdrezeonbyxgpyygl.supabase.co';  // ğŸ‘ˆ ìˆ˜ì • í•„ìš”
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjb2ZkcmV6ZW9uYnl4Z3B5eWdsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwNDk4NTQsImV4cCI6MjA4MTYyNTg1NH0.YXNqdcNA5sTWzS4pB-SRkfIvVLiPkdCkifpMEBqf2Xc';  // ğŸ‘ˆ ìˆ˜ì • í•„ìš”
        
        // Supabase ì´ˆê¸°í™”
        let supabase;
        let currentUser = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ
        window.addEventListener('load', async () => {
            console.log('í˜ì´ì§€ ë¡œë“œë¨');
            console.log('Supabase URL:', SUPABASE_URL);
            
            // Supabase ì„¤ì • í™•ì¸
            if (SUPABASE_URL.includes('your-project') || SUPABASE_KEY.includes('your-anon')) {
                document.getElementById('loginError').innerHTML = 
                    '<div class="alert alert-error">âš ï¸ Supabase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. admin.html íŒŒì¼ì˜ SUPABASE_URLê³¼ SUPABASE_KEYë¥¼ ìˆ˜ì •í•˜ì„¸ìš”.</div>';
                return;
            }
            
            try {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                console.log('Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±ë¨');
                
                // ì„¸ì…˜ í™•ì¸
                const { data: { session } } = await supabase.auth.getSession();
                if (session) {
                    currentUser = session.user;
                    showAdminScreen();
                }
            } catch (error) {
                console.error('ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                document.getElementById('loginError').innerHTML = 
                    `<div class="alert alert-error">ì´ˆê¸°í™” ì˜¤ë¥˜: ${error.message}</div>`;
            }
        });

        // ë¡œê·¸ì¸
        async function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const btn = document.getElementById('loginBtn');
            const errorDiv = document.getElementById('loginError');
            
            btn.disabled = true;
            btn.textContent = 'ë¡œê·¸ì¸ ì¤‘...';
            errorDiv.innerHTML = '';
            
            console.log('ë¡œê·¸ì¸ ì‹œë„:', email);
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({ email, password });
                
                console.log('ë¡œê·¸ì¸ ì‘ë‹µ:', { data, error });
                
                if (error) {
                    let msg = 'ë¡œê·¸ì¸ ì‹¤íŒ¨: ';
                    if (error.message.includes('Invalid')) msg += 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.';
                    else if (error.message.includes('Email not confirmed')) msg += 'ì´ë©”ì¼ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.';
                    else msg += error.message;
                    throw new Error(msg);
                }
                
                currentUser = data.user;
                console.log('ë¡œê·¸ì¸ ì„±ê³µ!');
                showAdminScreen();
                
            } catch (error) {
                console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                errorDiv.innerHTML = `<div class="alert alert-error">${error.message}</div>`;
            } finally {
                btn.disabled = false;
                btn.textContent = 'ë¡œê·¸ì¸';
            }
        }

        // ë¡œê·¸ì•„ì›ƒ
        async function handleLogout() {
            await supabase.auth.signOut();
            currentUser = null;
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('adminScreen').style.display = 'none';
        }

        // ê´€ë¦¬ì í™”ë©´ í‘œì‹œ
        function showAdminScreen() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminScreen').style.display = 'block';
            loadDashboard();
        }

        // íƒ­ ì „í™˜
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tab).classList.add('active');
            
            if (tab === 'dashboard') loadDashboard();
            if (tab === 'contacts') loadContacts();
            if (tab === 'faqs') loadFAQs();
        }

        // ëŒ€ì‹œë³´ë“œ ë¡œë“œ
        async function loadDashboard() {
            try {
                const { data: contacts } = await supabase.from('contacts').select('*');
                const { data: faqs } = await supabase.from('faqs').select('*');
                
                document.getElementById('totalContacts').textContent = contacts?.length || 0;
                document.getElementById('pendingContacts').textContent = 
                    contacts?.filter(c => c.status === 'ë¯¸ë‹µë³€').length || 0;
                document.getElementById('totalFAQs').textContent = faqs?.length || 0;
                
                const div = document.getElementById('recentContacts');
                if (!contacts || contacts.length === 0) {
                    div.innerHTML = '<div class="empty">ë¬¸ì˜ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                    return;
                }
                
                contacts.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                div.innerHTML = `<table><thead><tr><th>ë‚ ì§œ</th><th>ì´ë¦„</th><th>ì´ë©”ì¼</th><th>ìƒíƒœ</th></tr></thead><tbody>` +
                    contacts.slice(0, 5).map(c => `
                        <tr>
                            <td>${new Date(c.created_at).toLocaleDateString()}</td>
                            <td>${c.name}</td>
                            <td>${c.email}</td>
                            <td><span class="status-badge ${c.status === 'ë‹µë³€ì™„ë£Œ' ? 'status-completed' : 'status-pending'}">${c.status}</span></td>
                        </tr>
                    `).join('') + '</tbody></table>';
            } catch (error) {
                console.error('ëŒ€ì‹œë³´ë“œ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ë¬¸ì˜ ëª©ë¡ ë¡œë“œ
        async function loadContacts() {
            try {
                const { data: contacts, error } = await supabase
                    .from('contacts')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                const div = document.getElementById('contactsList');
                
                if (error) throw error;
                if (!contacts || contacts.length === 0) {
                    div.innerHTML = '<div class="empty">ë¬¸ì˜ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                    return;
                }
                
                div.innerHTML = `<table><thead><tr><th>ë‚ ì§œ</th><th>ì´ë¦„</th><th>ì´ë©”ì¼</th><th>ì—°ë½ì²˜</th><th>ìƒíƒœ</th><th>ì•¡ì…˜</th></tr></thead><tbody>` +
                    contacts.map(c => `
                        <tr>
                            <td>${new Date(c.created_at).toLocaleString()}</td>
                            <td>${c.name}</td>
                            <td>${c.email}</td>
                            <td>${c.phone}</td>
                            <td><span class="status-badge ${c.status === 'ë‹µë³€ì™„ë£Œ' ? 'status-completed' : 'status-pending'}">${c.status}</span></td>
                            <td>
                                <button class="btn btn-sm btn-success" onclick="updateStatus(${c.id}, 'ë‹µë³€ì™„ë£Œ')">ì™„ë£Œ</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteContact(${c.id})">ì‚­ì œ</button>
                            </td>
                        </tr>
                    `).join('') + '</tbody></table>';
            } catch (error) {
                console.error('ë¬¸ì˜ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ë¬¸ì˜ ìƒíƒœ ì—…ë°ì´íŠ¸
        async function updateStatus(id, status) {
            try {
                await supabase.from('contacts').update({ status }).eq('id', id);
                alert('ìƒíƒœ ë³€ê²½ ì™„ë£Œ');
                loadContacts();
                loadDashboard();
            } catch (error) {
                alert('ì˜¤ë¥˜: ' + error.message);
            }
        }

        // ë¬¸ì˜ ì‚­ì œ
        async function deleteContact(id) {
            if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            try {
                await supabase.from('contacts').delete().eq('id', id);
                alert('ì‚­ì œ ì™„ë£Œ');
                loadContacts();
                loadDashboard();
            } catch (error) {
                alert('ì˜¤ë¥˜: ' + error.message);
            }
        }

        // FAQ ëª©ë¡ ë¡œë“œ
        async function loadFAQs() {
            try {
                const { data: faqs, error } = await supabase
                    .from('faqs')
                    .select('*')
                    .order('order_num', { ascending: true });
                
                const div = document.getElementById('faqsList');
                
                if (error) throw error;
                if (!faqs || faqs.length === 0) {
                    div.innerHTML = '<div class="empty">FAQê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                    return;
                }
                
                div.innerHTML = `<table><thead><tr><th>ìˆœì„œ</th><th>ì§ˆë¬¸</th><th>ë‹µë³€</th><th>ì•¡ì…˜</th></tr></thead><tbody>` +
                    faqs.map(f => `
                        <tr>
                            <td>${f.order_num}</td>
                            <td>${f.question}</td>
                            <td>${f.answer.substring(0, 50)}...</td>
                            <td>
                                <button class="btn btn-sm btn-warning" onclick='editFAQ(${JSON.stringify(f)})'>ìˆ˜ì •</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteFAQ(${f.id})">ì‚­ì œ</button>
                            </td>
                        </tr>
                    `).join('') + '</tbody></table>';
            } catch (error) {
                console.error('FAQ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // FAQ ëª¨ë‹¬ ì—´ê¸°
        function openFAQModal() {
            document.getElementById('faqModalTitle').textContent = 'FAQ ì¶”ê°€';
            document.getElementById('faqId').value = '';
            document.getElementById('faqQuestion').value = '';
            document.getElementById('faqAnswer').value = '';
            document.getElementById('faqOrder').value = '1';
            document.getElementById('faqModal').classList.add('active');
        }

        // FAQ í¸ì§‘
        function editFAQ(faq) {
            document.getElementById('faqModalTitle').textContent = 'FAQ ìˆ˜ì •';
            document.getElementById('faqId').value = faq.id;
            document.getElementById('faqQuestion').value = faq.question;
            document.getElementById('faqAnswer').value = faq.answer;
            document.getElementById('faqOrder').value = faq.order_num;
            document.getElementById('faqModal').classList.add('active');
        }

        // FAQ ì €ì¥
        async function saveFAQ(e) {
            e.preventDefault();
            
            const id = document.getElementById('faqId').value;
            const data = {
                question: document.getElementById('faqQuestion').value,
                answer: document.getElementById('faqAnswer').value,
                order_num: parseInt(document.getElementById('faqOrder').value)
            };
            
            try {
                if (id) {
                    await supabase.from('faqs').update(data).eq('id', id);
                } else {
                    await supabase.from('faqs').insert([data]);
                }
                alert('ì €ì¥ ì™„ë£Œ');
                closeModal();
                loadFAQs();
                loadDashboard();
            } catch (error) {
                alert('ì˜¤ë¥˜: ' + error.message);
            }
        }

        // FAQ ì‚­ì œ
        async function deleteFAQ(id) {
            if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            try {
                await supabase.from('faqs').delete().eq('id', id);
                alert('ì‚­ì œ ì™„ë£Œ');
                loadFAQs();
                loadDashboard();
            } catch (error) {
                alert('ì˜¤ë¥˜: ' + error.message);
            }
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            document.getElementById('faqModal').classList.remove('active');
        }
    </script>
</body>
</html>
